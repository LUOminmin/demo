(function(e){function t(t){for(var s,r,o=t[0],l=t[1],c=t[2],u=0,m=[];u<o.length;u++)r=o[u],n[r]&&m.push(n[r][0]),n[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);d&&d(t);while(m.length)m.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],s=!0,o=1;o<a.length;o++){var l=a[o];0!==n[l]&&(s=!1)}s&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var s={},n={member_add_member:0},i=[];function r(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=s,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;i.push([12,"chunk-vendors","chunk-common"]),a()})({12:function(e,t,a){e.exports=a("fd84")},"2d83":function(e,t,a){},"714f":function(e,t,a){"use strict";var s=a("fd7c"),n=a.n(s);n.a},"725e":function(e,t,a){"use strict";var s=a("2d83"),n=a.n(s);n.a},fd7c:function(e,t,a){},fd84:function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var s=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{staticClass:"member_info"},[e.isEdit?e._e():a("label",{directives:[{name:"access",rawName:"v-access:store",arg:"store"}],ref:"store",staticClass:"line_box",on:{click:e.selectShop}},[e._m(0),a("div",{staticClass:"right"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.store_name,expression:"data.store_name"}],attrs:{type:"text",readonly:"readonly",placeholder:"请选择"},domProps:{value:e.data.store_name},on:{input:function(t){t.target.composing||e.$set(e.data,"store_name",t.target.value)}}})])]),a("List",{attrs:{list:e.textList},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.item;t.index;return[a("label",{staticClass:"line_box q-1px-b"},[a("div",{staticClass:"left"},[a("span",{directives:[{name:"show",rawName:"v-show",value:!s.isOver,expression:"!item.isOver"}],staticClass:"color_red"},[e._v("*")]),e._v(e._s(s.text)+"\n            ")]),a("div",{staticClass:"right"},["phone"==s.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.phone,expression:"data.phone"}],attrs:{type:"tel",placeholder:"请输入",maxlength:"11"},domProps:{value:e.data.phone},on:{input:function(t){t.target.composing||e.$set(e.data,"phone",t.target.value)}}}):e._e(),"name"==s.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.user_name,expression:"data.user_name"}],attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.data.user_name},on:{input:function(t){t.target.composing||e.$set(e.data,"user_name",t.target.value)}}}):e._e(),"sex"==s.type?a("ul",{staticClass:"item_sex"},[a("li",{staticClass:"sex"},[a("i",{class:1===e.data.sex?"checked":"uncheck",on:{click:function(t){return e.onChooseSex(1)}}}),a("label",[e._v("男")])]),a("li",{staticClass:"sex"},[a("i",{staticClass:"uncheck",class:0===e.data.sex?"checked":"uncheck",on:{click:function(t){return e.onChooseSex(0)}}}),a("label",[e._v("女")])])]):e._e(),"level"==s.type?a("span",{on:{click:function(t){return e.selectLevel()}}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.user_level_name,expression:"data.user_level_name"}],attrs:{type:"text",placeholder:"请选择",disabled:""},domProps:{value:e.data.user_level_name},on:{input:function(t){t.target.composing||e.$set(e.data,"user_level_name",t.target.value)}}})]):e._e(),"card_no"==s.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.card_no,expression:"data.card_no"}],attrs:{type:"number",placeholder:"请输入"},domProps:{value:e.data.card_no},on:{input:function(t){t.target.composing||e.$set(e.data,"card_no",t.target.value)}}}):e._e(),"birthday"==s.type?a("span",{directives:[{name:"show",rawName:"v-show",value:e.data.memberOld,expression:"data.memberOld"}],staticClass:"member_old"},[e._v(e._s(e.data.memberOld))]):e._e(),"birthday"==s.type?a("span",{on:{click:function(t){return e.onMemDate()}}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.birthday,expression:"data.birthday"}],staticClass:"birth_input",attrs:{type:"text",placeholder:"请选择",disabled:""},domProps:{value:e.data.birthday},on:{input:function(t){t.target.composing||e.$set(e.data,"birthday",t.target.value)}}})]):e._e(),"referee_name"==s.type?a("input",{directives:[{name:"model",rawName:"v-model",value:e.data.referee_name,expression:"data.referee_name"}],attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.data.referee_name},on:{input:function(t){t.target.composing||e.$set(e.data,"referee_name",t.target.value)}}}):e._e()])])]}}])})],1),a("div",{staticClass:"baby_info"},[a("List",{attrs:{list:e.data.baby_list},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.item,n=t.index;return[a("BabyList",{attrs:{item:s,index:n},on:{babyInfo:e.getBabyInfo}})]}}])})],1),e.data.baby_list.length<3?a("div",{staticClass:"add_baby_info",on:{click:e.addBaby}},[e._v("十 添加宝宝")]):e._e()])},i=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"left"},[a("span",{staticClass:"color_red"},[e._v("*")]),e._v("门店\n      ")])}],r=a("a3d3"),o=a("b2eb"),l=a("21f4"),c=a("6abe"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"baby_list"},[a("label",{staticClass:"line_box q-1px-b"},[a("div",{staticClass:"left"},[e._v(e._s(0===e.index?"大宝":1===e.index?"二宝":"三宝"))]),a("div",{staticClass:"right"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.item.baby_name,expression:"item.baby_name"}],attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.item.baby_name},on:{input:function(t){t.target.composing||e.$set(e.item,"baby_name",t.target.value)}}})])]),a("div",{staticClass:"line_box q-1px-b"},[a("div",{staticClass:"left"},[e._v("宝宝性别")]),a("div",{staticClass:"right"},[a("ul",{staticClass:"item_flex"},[a("li",{staticClass:"sex"},[a("i",{class:1===e.item.baby_sex?"checked":"uncheck",on:{click:function(t){return e.onChooseSex(1)}}}),a("label",[e._v("男")])]),a("li",{staticClass:"sex"},[a("i",{staticClass:"uncheck",class:0===e.item.baby_sex?"checked":"uncheck",on:{click:function(t){return e.onChooseSex(0)}}}),a("label",[e._v("女")])])])])]),a("label",{staticClass:"line_box q-1px-b"},[a("div",{staticClass:"left"},[e._v("宝宝生日")]),a("div",{staticClass:"right",on:{click:function(t){return e.onSelectDate()}}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.item.birthday,expression:"item.birthday"}],attrs:{type:"text",placeholder:"请选择",disabled:""},domProps:{value:e.item.birthday},on:{input:function(t){t.target.composing||e.$set(e.item,"birthday",t.target.value)}}})])]),a("div",{staticClass:"line_box q-1px-b"},[a("div",{staticClass:"left"},[e._v("喂养方式")]),a("div",{staticClass:"right"},[a("ul",{staticClass:"item_flex"},e._l(e.feeds,function(t,s){return a("li",{key:s,staticClass:"feed"},[a("i",{class:e.item.feeding_pattern==t.val?"checked":"uncheck",on:{click:function(a){return e.onChooseFeed(t.val)}}}),a("label",[e._v(e._s(t.name))])])}),0)])])])},u=[],m=(a("c5f6"),{name:"BabyList",props:{item:Object,index:Number},data:function(){return{feeds:[{name:"母乳",val:"001"},{name:"人工",val:"002"},{name:"混合",val:"003"}]}},mounted:function(){var e=this;o["a"].subscribe("customCheckBabyInfo",function(){e.$emit("babyInfo",e.item,e.index)})},created:function(){},methods:{onSelectDate:function(){var e=this,t=e.item.birthday||new Date;r["a"].openPicker({type:"date",date:t},function(t){1==String(t.month).length&&(t.month="0"+t.month),1==String(t.day).length&&(t.day="0"+t.day);var a=t.year+"-"+t.month+"-"+t.day;e.item.birthday=a})},onChooseSex:function(e){this.item.baby_sex=e},onChooseFeed:function(e){this.item.feeding_pattern=e}}}),v=m,p=(a("714f"),a("2877")),f=Object(p["a"])(v,d,u,!1,null,"8d82c71e",null),_=f.exports,b=a("5d73"),h=a.n(b),y=a("adb5"),x=a("87ad"),g={getDetail:function(e){if(x["a"].getUserId()){var t={user_id:x["a"].getUserId()},a="/app/auth/crm/user/getDetail.do";return y["a"].ajax({url:a,api_versions:"v2",action:"获取会员详情",data:t,success:function(t){var a=t.object||{};a.memberOld=x["a"].getMemberOld(a.birthday),e.success&&e.success(a)},error:function(t){e.error&&e.error(t)}}),!0}return!1},checkData:function(e,t){var a=e||{};return t&&!a.store_id?(r["a"].toast("会员所属门店不能为空！"),!1):a.phone?/^1[0-9]{10}$/.test(a.phone)?a.user_name?""===a.sex?(r["a"].toast("会员性别不能为空",{location:"middle"}),!1):a.user_level_name?a.birthday?(o["a"].publish("customCheckBabyInfo"),void this.saveCrmUser(a)):(r["a"].toast("请填写会员生日",{location:"middle"}),!1):(r["a"].toast("会员等级不能为空！",{location:"middle"}),!1):(r["a"].toast("会员姓名不能为空！",{location:"middle"}),!1):(r["a"].toast("手机号格式错误",{location:"middle"}),!1):(r["a"].toast("会员手机不能为空！",{location:"middle"}),!1)},getLevelList:function(e){var t="/app/auth/crm/user/listCrmUserLevel.do";y["a"].ajax({data:{},url:t,api_versions:"v2",success:function(t){var a=t.object||[],s={level_names:[],level_ids:[]},n=!0,i=!1,r=void 0;try{for(var o,l=h()(a);!(n=(o=l.next()).done);n=!0){var c=o.value;s.level_names.push(c.user_level_name||""),s.level_ids.push(c.user_level_id||"")}}catch(d){i=!0,r=d}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}e.success&&e.success(s)},error:function(){e.error&&e.error()}})},getStore:function(e){var t="/app/auth/store/list.do";y["a"].ajax({url:t,data:{},api_versions:"v2",success:function(t){if(t.success){var a=t.object||[],s={store_id:[],org_name:[]},n=!0,i=!1,o=void 0;try{for(var l,c=h()(a);!(n=(l=c.next()).done);n=!0){var d=l.value;d.store_id&&(s.store_id.push(d.store_id),s.org_name.push(d.org_name||""))}}catch(u){i=!0,o=u}finally{try{n||null==c.return||c.return()}finally{if(i)throw o}}e&&e(s)}else r["a"].toast(t.message)}})},saveCrmUser:function(e){r["a"].confirm("是否确认保存",function(){for(var t=e,a="/app/auth/crm/user/saveCrmUser.do",s=t.baby_list.length-1;s>=0;s--)t.baby_list[s].baby_name||t.baby_list.splice(s,1);x["a"].getUserId()&&(a="/app/auth/crm/user/editCrmUser.do",t.user_id=x["a"].getUserId()),y["a"].ajax({data:t,url:a,api_versions:"v2",success:function(){o["a"].publish("customRefreshMember"),r["a"].close("member_add_member",{isFrame:!1})},error:function(e){r["a"].toast(e.message,{location:"middle"})}})})}},C={name:"add_member",components:{List:c["a"],BabyList:_},data:function(){return{isStore:!1,isEdit:!1,textList:[{text:"会员手机号",type:"phone"},{text:"会员姓名",type:"name"},{text:"会员性别",type:"sex"},{text:"会员等级",type:"level"},{text:"会员卡号",type:"card_no",isOver:!0},{text:"会员生日",type:"birthday"},{text:"推荐人",type:"referee_name",isOver:!0}],storeList:[],storeIdList:[],levelList:[],levelIdList:[],data:{phone:null,user_name:null,sex:"",user_level_name:null,user_level_id:null,card_no:"",birthday:null,referee_name:null,memberOld:null,baby_list:[{baby_name:"",baby_sex:"",birthday:"",feeding_pattern:""}]}}},created:function(){},mounted:function(){var e=this;this.getLevelList(),this.getStore(),o["a"].subscribe("customSaveMember",function(){e.checkData()}),this.$nextTick(function(){e.$refs.store&&e.$refs.store.display&&(e.isStore="none"!=e.$refs.store.style.display),e.getDetail()})},methods:{selectShop:function(){var e=this;r["a"].actionSheet({buttons:this.storeList},function(t){e.$set(e.data,"store_name",e.storeList[t-1]),e.$set(e.data,"store_id",e.storeIdList[t-1])})},getStore:function(){var e=this;g.getStore(function(t){e.storeList=t.org_name,e.storeIdList=t.store_id})},getDetail:function(){var e=this;this.isEdit=g.getDetail({success:function(t){e.data=t}})},onChooseSex:function(e){this.data.sex=e},getLevelList:function(){var e=this;g.getLevelList({success:function(t){e.levelList=t.level_names,e.levelIdList=t.level_ids}})},selectLevel:function(){var e=this;r["a"].actionSheet({buttons:this.levelList},function(t){e.data.user_level_name=e.levelList[t-1],e.data.user_level_id=e.levelIdList[t-1]})},onMemDate:function(){var e=this,t=this.data.birthday||new Date;r["a"].openPicker({type:"date",date:t},function(t){t&&(e.data.birthday=t.year+"-"+l["a"].addZero(t.month)+"-"+l["a"].addZero(t.day),e.data.memberOld=e.data.birthday.substr(2,1)+"0后")})},getBabyInfo:function(e,t){this.data.baby_list[t]=e},addBaby:function(){var e={baby_name:"",baby_sex:"",birthday:"",feeding_pattern:""};this.data.baby_list.push(e)},checkData:function(){g.checkData(this.data,this.isStore)}}},w=C,k=(a("725e"),Object(p["a"])(w,n,i,!1,null,"a2a786da",null)),L=k.exports,S=a("d8ac");s["a"].config.productionTip=!1,S["a"].start(s["a"]),window.EventBus=new s["a"],window.isPc()?(console.log("pc"),new s["a"]({render:function(e){return e(L)},data:{Bus:new s["a"]}}).$mount("#app")):(console.log("移动端"),window.apiready=function(){new s["a"]({render:function(e){return e(L)}}).$mount("#app")})}});